<script type="text/discourse-plugin" version="0.8">
    const user = api.getCurrentUser();
    const {setDefaultHomepage } = require('discourse/lib/utilities');
    if (settings.mobile_homepage) {
        setDefaultHomepage(settings.mobile_homepage);
}
else {
    	if (user && user.primary_group_name) {
    		if (settings.group_page_map) {
     			var groupMap = settings.group_page_map.replace(',',':').split('|');
     			const mapEntry = groupMap.find(value => RegExp(user.primary_group_name).test(value));
				if (mapEntry) {
      				const url= mapEntry.split(':')[1];
      				setDefaultHomepage(url);
				}
		}
   	} 
	 else {
	 	if (settings.anon_page) {
	 	setDefaultHomepage(settings.anon_page);
		}
	}
}
</script>
